import fetch from 'node-fetch';
//const {fetch} = require('node-fetch')
//const {MongoClient} = require('mongodb');
import {MongoClient} from 'mongodb';
const apikey = "9bb9485e113f7f8e07520d9f65878e19";

async function main(){
	const uri = 'mongodb+srv://rishav83:ogiVMdcnM4Y82kdQ@mausam.cxbamxl.mongodb.net/?retryWrites=true&w=majority';
	const client = new MongoClient(uri);

	try{
		await client.connect();
		const data = await fetch("https://api.openweathermap.org/data/2.5/weather?lat="
				+22.4
				+"&lon="
				+88.8
				+"&appid="
				+apikey
				+"&units=metric");
		const response  = await data.json();
		const {name} = response;
		const {speed} = response.wind;
		//await listDatabases(client);
		console.log(name,speed);
		await createListing(client,
        {
        	city_name : name,
        	speed :speed, 
            
        },name);
	}
	catch(e){
		console.error(e);
	}
	finally{
		await client.close();
	}
}

main().catch(console.error); //call the main function

// async function listDatabases(client){		//to list my databases
// 	dataBasesList = await client.db().admin().listDatabases();
// 	console.log("Databases:");

// 	dataBasesList.databases.forEach(db => console.log(` - ${db.name}`));
// }

async function createListing(client,newlisting,name){
	const result = await client.db("Cities").collection(name).insertOne(newlisting);
	console.log(`New listing created with the following id: ${result.insertedId}`);
}
